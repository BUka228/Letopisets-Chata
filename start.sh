#!/bin/bash

set -e

echo "Запуск Telegram бота в фоновом режиме..."
# Запускаем основной скрипт бота в фоне (&)
# Перенаправляем stdout и stderr в логи контейнера (необязательно, Render и так их ловит)
python main.py > bot.log 2>&1 &

# Сохраняем PID фонового процесса бота (необязательно, но полезно для отладки)
BOT_PID=$!
echo "PID бота: ${BOT_PID}"

echo "Запуск вспомогательного веб-сервера для Render health checks..."
# Запускаем веб-сервер на переднем плане. Он будет слушать порт $PORT.
# Этот процесс будет удерживать контейнер активным для Render.
python web_server.py

# Если веб-сервер завершится, можно попытаться остановить и бота (не обязательно)
# echo "Веб-сервер остановлен. Остановка бота..."
# kill $BOT_PID
# wait $BOT_PID # Ждем завершения бота